From 4307ed31091d9c866747ee3f3c11d06989228289 Mon Sep 17 00:00:00 2001
From: Samuel <heiyiutam@gmail.com>
Date: Sat, 1 Jun 2019 16:36:16 +0800
Subject: [PATCH 1/6] Patch SystemUI for AOD

---
 .../statusbar/phone/DozeParameters.smali      |   4 +-
 .../systemui/statusbar/phone/StatusBar.smali  | 205 +-----------------
 2 files changed, 3 insertions(+), 206 deletions(-)

diff --git a/OPSystemUI/smali/com/android/systemui/statusbar/phone/DozeParameters.smali b/OPSystemUI/smali/com/android/systemui/statusbar/phone/DozeParameters.smali
index f92f141..ce1e099 100644
--- a/OPSystemUI/smali/com/android/systemui/statusbar/phone/DozeParameters.smali
+++ b/OPSystemUI/smali/com/android/systemui/statusbar/phone/DozeParameters.smali
@@ -276,9 +276,7 @@
     .locals 1
 
     .line 187
-    sget-boolean v0, Lcom/android/systemui/statusbar/phone/DozeParameters;->FORCE_NO_BLANKING:Z
-
-    xor-int/lit8 v0, v0, 0x1
+    const v0, 0x0
 
     return v0
 .end method
diff --git a/OPSystemUI/smali/com/android/systemui/statusbar/phone/StatusBar.smali b/OPSystemUI/smali/com/android/systemui/statusbar/phone/StatusBar.smali
index 6874a97..f1dca85 100644
--- a/OPSystemUI/smali/com/android/systemui/statusbar/phone/StatusBar.smali
+++ b/OPSystemUI/smali/com/android/systemui/statusbar/phone/StatusBar.smali
@@ -20399,154 +20399,7 @@
     .param p2, "overlayLayout"    # Z
     .param p3, "authType"    # I
 
-    .line 7082
-    if-nez p2, :cond_0
-
-    invoke-static {}, Lcom/android/systemui/plugin/LSState;->getInstance()Lcom/android/systemui/plugin/LSState;
-
-    move-result-object v0
-
-    invoke-virtual {v0}, Lcom/android/systemui/plugin/LSState;->getPreventModeCtrl()Lcom/android/systemui/plugin/PreventModeCtrl;
-
-    move-result-object v0
-
-    invoke-virtual {v0}, Lcom/android/systemui/plugin/PreventModeCtrl;->isPreventModeNoBackground()Z
-
-    move-result v0
-
-    if-eqz v0, :cond_0
-
-    .line 7083
-    const-string v0, "StatusBar"
-
-    const-string v1, "not set alpha when prevent"
-
-    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
-
-    .line 7084
-    return-void
-
-    .line 7088
-    :cond_0
-    const/4 v0, 0x0
-
-    cmpg-float v0, p1, v0
-
-    if-gtz v0, :cond_1
-
-    if-eqz p2, :cond_1
-
-    iget-boolean v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mBouncerShowing:Z
-
-    if-eqz v0, :cond_1
-
-    .line 7089
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mStatusBarKeyguardViewManager:Lcom/android/systemui/statusbar/phone/StatusBarKeyguardViewManager;
-
-    const/4 v1, 0x1
-
-    invoke-virtual {v0, v1}, Lcom/android/systemui/statusbar/phone/StatusBarKeyguardViewManager;->reset(Z)V
-
-    .line 7093
-    :cond_1
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mNotificationPanel:Lcom/android/systemui/statusbar/phone/NotificationPanelView;
-
-    if-nez v0, :cond_2
-
-    return-void
-
-    .line 7094
-    :cond_2
-    invoke-static {}, Lcom/android/systemui/util/OPUtils;->isCustomFingerprint()Z
-
-    move-result v0
-
-    if-eqz v0, :cond_7
-
-    .line 7095
-    const/high16 v0, 0x3f800000    # 1.0f
-
-    cmpg-float v0, p1, v0
-
-    if-gez v0, :cond_5
-
-    .line 7096
-    sget v0, Lcom/android/systemui/keyguard/KeyguardViewMediator;->AUTHENTICATE_FACEUNLOCK:I
-
-    if-eq p3, v0, :cond_4
-
-    if-eqz p2, :cond_3
-
-    goto :goto_0
-
-    .line 7099
-    :cond_3
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mNotificationPanel:Lcom/android/systemui/statusbar/phone/NotificationPanelView;
-
-    invoke-virtual {v0, p1}, Lcom/android/systemui/statusbar/phone/NotificationPanelView;->setUnlockAlpha(F)V
-
-    goto :goto_1
-
-    .line 7097
-    :cond_4
-    :goto_0
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mNotificationPanel:Lcom/android/systemui/statusbar/phone/NotificationPanelView;
-
-    invoke-virtual {v0, p1}, Lcom/android/systemui/statusbar/phone/NotificationPanelView;->setAlpha(F)V
-
-    goto :goto_1
-
-    .line 7103
-    :cond_5
-    const-class v0, Lcom/android/systemui/statusbar/policy/ChargingAnimationController;
-
-    invoke-static {v0}, Lcom/android/systemui/Dependency;->get(Ljava/lang/Class;)Ljava/lang/Object;
-
-    move-result-object v0
-
-    check-cast v0, Lcom/android/systemui/statusbar/policy/ChargingAnimationController;
-
-    invoke-interface {v0}, Lcom/android/systemui/statusbar/policy/ChargingAnimationController;->isAnimationStarted()Z
-
-    move-result v0
-
-    if-eqz v0, :cond_6
-
-    sget v0, Lcom/android/systemui/keyguard/KeyguardViewMediator;->AUTHENTICATE_FINGERPRINT:I
-
-    if-ne p3, v0, :cond_6
-
-    .line 7105
-    const-string v0, "StatusBar"
-
-    const-string v1, "not set alpha when warp"
-
-    invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
-
-    .line 7106
-    return-void
-
-    .line 7109
-    :cond_6
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mNotificationPanel:Lcom/android/systemui/statusbar/phone/NotificationPanelView;
-
-    invoke-virtual {v0, p1}, Lcom/android/systemui/statusbar/phone/NotificationPanelView;->setAlpha(F)V
-
-    .line 7110
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mNotificationPanel:Lcom/android/systemui/statusbar/phone/NotificationPanelView;
-
-    invoke-virtual {v0, p1}, Lcom/android/systemui/statusbar/phone/NotificationPanelView;->setUnlockAlpha(F)V
-
-    goto :goto_1
-
-    .line 7113
-    :cond_7
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mNotificationPanel:Lcom/android/systemui/statusbar/phone/NotificationPanelView;
-
-    invoke-virtual {v0, p1}, Lcom/android/systemui/statusbar/phone/NotificationPanelView;->setAlpha(F)V
-
-    .line 7115
-    :goto_1
+    .line 6710
     return-void
 .end method
 
@@ -20904,61 +20757,7 @@
     .locals 4
     .param p1, "alpha"    # F
 
-    .line 7123
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mScrimController:Lcom/android/systemui/statusbar/phone/ScrimController;
-
-    const/4 v1, 0x0
-
-    if-eqz v0, :cond_1
-
-    .line 7124
-    cmpl-float v0, p1, v1
-
-    const/4 v2, 0x0
-
-    if-nez v0, :cond_0
-
-    .line 7125
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mScrimController:Lcom/android/systemui/statusbar/phone/ScrimController;
-
-    const/4 v3, 0x1
-
-    invoke-virtual {v0, v3, v2}, Lcom/android/systemui/statusbar/phone/ScrimController;->forceHideScrims(ZZ)V
-
-    goto :goto_0
-
-    .line 7127
-    :cond_0
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mScrimController:Lcom/android/systemui/statusbar/phone/ScrimController;
-
-    invoke-virtual {v0, v2, v2}, Lcom/android/systemui/statusbar/phone/ScrimController;->forceHideScrims(ZZ)V
-
-    .line 7134
-    :cond_1
-    :goto_0
-    cmpl-float v0, p1, v1
-
-    if-nez v0, :cond_2
-
-    .line 7135
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mBackdrop:Lcom/android/systemui/statusbar/BackDropView;
-
-    invoke-virtual {v0}, Lcom/android/systemui/statusbar/BackDropView;->animate()Landroid/view/ViewPropertyAnimator;
-
-    move-result-object v0
-
-    invoke-virtual {v0}, Landroid/view/ViewPropertyAnimator;->cancel()V
-
-    .line 7140
-    const p1, 0x3b03126f    # 0.002f
-
-    .line 7142
-    :cond_2
-    iget-object v0, p0, Lcom/android/systemui/statusbar/phone/StatusBar;->mBackdrop:Lcom/android/systemui/statusbar/BackDropView;
-
-    invoke-virtual {v0, p1}, Lcom/android/systemui/statusbar/BackDropView;->setAlpha(F)V
-
-    .line 7143
+    .line 6739
     return-void
 .end method
 
-- 
2.17.1

